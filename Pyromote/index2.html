<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<title></title>
	<link rel="stylesheet" type="text/css" media="screen" href="fonts/css/raleway.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="fonts/css/nova-square.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="css/master2.css" />
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
	<!--[if IE]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<script type="text/javascript" src="js/vendor/jquery.js"></script>

	<script type="text/javascript" src="js/vendor/jquery.easing.js"></script>
	<script type="text/javascript" src="js/vendor/jquery.hotkeys.js"></script>
	<script type="text/javascript" src="js/vendor/jquery.playsound.js"></script>
	
	<!--script type="text/javascript" src="socket.io/socket.io.js"></script-->

	<script>
	  // var socket = io.connect('http://192.168.1.100:8888');
	</script>
	<script type="text/javascript" src="js/utils.js"></script>
	<script type="text/javascript" src="js/pyro.config.js"></script>
	<script type="text/javascript" src="js/pyro.grid.js"></script>
	<script type="text/javascript" src="js/pyro.sphere.js"></script>
	<script type="text/javascript" src="js/pyro.motions.js"></script>
	
	<script type="text/javascript">
		$(function(){
			var xy = new Object();
				xy.action = new Object();
				xy.status = new Object();
				xy.sphere = $.pyrosphere();
				
				xy.transitions = new Array();
				
				xy.transitions = shuffle(xy.transitions);
				
				xy.update = function( pos, scope ){
					
					var $grid = $(this);
					
					xy.status.dim = new Object();
					xy.status.dim.width = scope.$pointer.width();
					xy.status.dim.height = scope.$pointer.height();
					
					//Interfacing limits. Considering axis inversion, max width or height.
					xy.status.limits = new Object();
					xy.status.limits.duration = !scope.options.invertAxis ? $grid.outerWidth() : $grid.outerHeight();
					xy.status.limits.interval = !scope.options.invertAxis ? $grid.outerHeight() : $grid.outerWidth();
					
					//Raw touch values, not normalized to ranges yet. Considering user preference.
					xy.status.oriented = new Object();
					xy.status.oriented.duration = !scope.options.invertAxis ? pos.x : pos.y;
					xy.status.oriented.interval = !scope.options.invertAxis ? pos.y : pos.x;
					
					//Normalized Values, ready to set sphere.
					xy.status.normalized = new Object();
					xy.status.normalized.duration = Math.round(normalize(xy.status.oriented.duration, 0, xy.status.limits.duration, $.Pyro.Config.Limits.Duration.Min, $.Pyro.Config.Limits.Duration.Max)); //no less than 30 MS, no longer than 750 ms. (flameDuration)
					xy.status.normalized.interval = Math.round(normalize(xy.status.oriented.interval, 0, xy.status.limits.interval, $.Pyro.Config.Limits.Interval.Min, $.Pyro.Config.Limits.Interval.Max)); //no less than 30 MS, no longer than 750 ms. (flameDuration)
					
				}
				
				xy.action.setup = function( scope ){
					var $grid = $(this);
					
					scope.transitions = [
						{ left : scope.$pointer.width()*-1 }, //left
						{ left : $(document).width() 			 }, //right
						{ top : scope.$pointer.height()*-1  }, //up
						{ top : $(document).height()       }, //down
						{ left : scope.$pointer.width()*-1, top : scope.$pointer.height()*-1 }, //left up
						{ left : scope.$pointer.width()*-1, top : $(document).height() }, //left down
						{ left : $(document).width(), top : scope.$pointer.height()*-1 }, //right up
						{ left : $(document).width(), top : $(document).height() } //right down
					];
					
					$grid.data('Pyro.TouchGrid', scope);
					
					return true;
				}
				
				xy.action.change = function( pos, event, scope ){
					var size = new Object();
							size.x = normalize(scope.status.value.x, 20, 750, 40, 200, true ); // between 40 and 200, round it
							size.y = normalize(scope.status.value.y, 20, 750, 40, 200, true ); // ^
							
					scope.$stats.find('.x .value').css('font-size', size.x+'pt');
					scope.$stats.find('.y .value').css('font-size', size.y+'pt');
					
					xy.sphere
				}
				
				xy.action.normalize = function( pos, event, scope ) {
					xy.update.apply( this, [pos, scope] );
					return {
						x : !scope.options.invertAxis ? xy.status.normalized.duration : xy.status.normalized.interval,
						y : !scope.options.invertAxis ? xy.status.normalized.interval : xy.status.normalized.duration
					}
				}
				
				xy.action.pointer = function( pos, scope ){ 
					
					var $grid = $(this);
					var $pointer = scope.$pointer;
					var $stats = scope.$stats;

					//Alpha
					var average = (scope.status.pos.x + scope.status.pos.y) / 2;
					var max = $grid.width() > $grid.height() ? $grid.width()  : $grid.height(); //Bigger of the two
					var alpha = normalize(average, 0, max, 0.10, 0.60); //Normalize average between
					$pointer.find('.gradient').css('opacity', alpha);
					
					//Size
					var raw = new Object();
							raw.x = (!scope.options.invertAxis) ? scope.status.value.y : scope.status.value.x;
							raw.y = (!scope.options.invertAxis) ? scope.status.value.x : scope.status.value.y;
							
					var normal = new Object();
							normal.width = Math.round(normalize(raw.x, $.Pyro.Config.Limits.Duration.Min, $.Pyro.Config.Limits.Duration.Max, 30, $(document).width()*2) );
							normal.height = Math.round(normalize(raw.y, $.Pyro.Config.Limits.Interval.Min, $.Pyro.Config.Limits.Interval.Max, 30, $(document).height()*2) );
							
					$pointer.css('width', normal.width+'px').css('height', normal.height+'px')
					
				}
		
				xy.action.move = function( pos, event, scope ){
					
				}
		
				xy.action.down = function( pos, event, scope ){ 
					var $grid = $(this);	
					scope.$pointer.css({ opacity : 1 });
					
					if(scope.status.idle) { $.playSound('sounds/positive.wav', 2000); base.status.idle = false; }
					else { $.playSound('sounds/welcome.wav', 1000); }
				}
		
				xy.action.up = function( event, scope ){
					var $grid = $(this);
					
					var rand = Math.round(Math.random() * (scope.transitions.length-1) );
					
					xy.action.setup.apply( this, [ scope ] );
					
					scope = $grid.data('Pyro.TouchGrid');
					
					if(!scope.options.hold) {
						
						var trans = scope.transitions[rand];
								trans.easing = 'easeInExpo';
								trans.opacity = 0;
						// 							
						// 							console.log(trans);
						// 					
								scope.$pointer.stop().animate(trans, 100, function(){
											// scope.$pointer.css({ left : scope.$pointer.width()*-1, top : scope.$pointer.width()*-1 });
								});
						// 					
						// $('.follower').fadeOut(100);
						// sphere.pyrosphere('set', 'on', false);
						// scope.options.active = false;
					}
					
					return true; //RETURN TRUE! If not, default core functionality (HIDE) will take over. You'll get frustrated. Return true.
				}
				
				xy.gridconfig = {
					labelX : 'Duration',
					labelY : 'Interval',
					// hold : true,
					// useX : false,
					pressmove : xy.action.move,
					pressdown : xy.action.down,
					pressup : xy.action.up,
					alterValue : xy.action.normalize,
					pointer : xy.action.pointer,
					change : xy.action.change,
					setup : xy.action.setup
				}
				
				xy.sessionconfig = {}
			
			var $xygrid = $('#grid').pyrogrid( xy.config );
			
			// console.log($grid);
			// console.log($patterns);
			// console.log($sphere);
		});	
		
		var sliders = new Object();
		var valves = new Object();
		
		
		
	</script>
	
</head>
<body>
	<!-- <header>
		<ul>
			<li class="title">Pyrosphere 2013</li>
			<li class="duration"><span class="key">Duration</span><span class="value">&nbsp;</span></li>
			<li class="interval"><span class="key">Interval</span><span class="value">&nbsp;</span></li>
			<li class="pattern"><span class="key">Pattern</span><span class="value">&nbsp;</span></li>
		</ul>
	</header> -->
	
	<!-- <nav class="tab-menu hide-when-active nav">
		<ul>
			<li><a href="#">Control</a></li>
			<li><a href="#">Grid</a></li>
			<li><a href="#">Grid</a></li>
		</ul>
	</nav> -->
	
<!-- 	<section id="idle">
		<span class=""></span>
	</section> -->
	
	<section id="pyromote" role="frame">

		<article id="master" class="mode container">
			
			<div id="grid"></div>
			<div class="patterns"></div>
			
		</article>
		
	<!-- 		<article id="tracer">
				
			</article>
			 -->
	</section>
	
	<!-- <section id="patterns" role="patterns"></section> -->
	

	
	<section role="xaxis"></section>
	<section role="yaxis"></section>
</body>
</html>